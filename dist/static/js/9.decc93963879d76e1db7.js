webpackJsonp([9],{DAa2:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("ZLEe"),o=a.n(i),n=a("aA9S"),s=a.n(n),r=a("pnga"),l=a("zQDM"),c=a("405r"),u=a.n(c),m={components:{CommonTag:r.a,CommonQuery:l.a,Draggable:u.a},data:function(){return{game_typeAddOrUpdateRequest:"game-service/1.0.0/game_type/addOrUpdate",game_typeDeleteRequest:"game-service/1.0.0/game_type/delete",game_infoListRequest:"game-service/1.0.0/game_info/list",rankGameByTypeRequest:"game-service/1.0.0/game_type_mapping/rankGameByType",game_typeListRequest:"game-service/1.0.0/game_type/list",findHomePageGameInfoRequest:"game-service/1.0.0/game_info/findHomePageGameInfo",operationGameTypeMappingRequest:"game-service/1.0.0/game_type_mapping/operationGameTypeMapping",rankListRequest:"game-service/1.0.0/game_info/rank/list",queryModel:{deviceType:this.currentDeviceType,gameTypeId:this.currentGameTypeId},pagination:{page:1,limit:20},formData:{id:0,name:"",title:"",description:"",iconUrl:"",bigImageUrl:"",iosDownloadUrl:"",androidDownloadUrl:"",webGameUrl:"",nature:"",ios:!1,android:!1,status:null},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"Edit",create:"Create"},dialogPvVisible:!1,rules:{name:[{required:!0,message:"此项为不能为空",trigger:"change"}]},loading:!1,fileList:[],gameTypeInfo:[],gameTypeId:"",initSortData:[],currentSortData:[],currentTopNumber:0,currentGameTypeId:1,currentDeviceType:"android",autoCompleteList:[],gameOptions:[],chosenGameName:"",chosenGameInfo:{}}},computed:{layoutHeight:function(){return this.$store.state.app.layoutHeight-40}},watch:{"formData.bigImageUrl":function(e){console.warn(e)},chosenGameName:function(e){this.queryModel.name=e},initSortData:function(e){console.log(e)}},mounted:function(){this.getGameTypeInfo()},methods:{getGameTypeInfo:function(){var e=this;this.loading=!0,this.queryModel=s()(this.queryModel,this.pagination),this.$http.get(this.$baseUrl+this.game_typeListRequest,{params:this.queryModel}).then(function(t){console.warn(t),e.gameTypeInfo=t,e.currentTopNumber=e.gameTypeInfo.list[0].topNumber,e.currentGameTypeId=e.gameTypeInfo.list[0].id,e.queryModel=s()(e.queryModel,{deviceType:e.currentDeviceType,gameTypeId:e.currentGameTypeId}),e.getSortList(),e.loading=!1})},getSortList:function(){var e=this,t="";this.loading=!0,["android","ios"].forEach(function(a){o()(e.queryModel).forEach(function(i){a===i&&!0===e.queryModel[i]&&(t=a)})}),console.log(this.queryModel),console.log(t),this.$http.get(this.$baseUrl+this.rankListRequest,{headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{gameTypeId:this.currentGameTypeId,deviceType:this.queryModel.deviceType}}).then(function(t){console.log(t),e.initSortData=[],e.currentSortData=[],t.list.forEach(function(t,a){e.$set(e.initSortData,a,t)}),t.list.forEach(function(t,a){e.$set(e.currentSortData,a,t)}),e.loading=!1})},chooseGameType:function(e){console.log(e),this.currentGameTypeId=this.gameTypeInfo.list[e.index].id,this.currentTopNumber=this.gameTypeInfo.list[e.index].topNumber,this.queryModel=s()(this.queryModel,{page:1,limit:this.currentTopNumber,name:"",status:1,title:"",description:"",gameTypeId:this.currentGameTypeId}),this.getSortList()},chooseDeviceType:function(e){console.log(e),this.currentDeviceType=this.$store.state.app.deviceTypeDictionary[e.index].code,this.queryModel=s()(this.queryModel,{gameTypeId:this.currentGameTypeId,deviceType:this.currentDeviceType}),console.log(this.queryModel),this.getSortList()},handleAddGame:function(){this.dialogFormVisible=!0,this.queryModel.name="",this.chosenGameName=""},addGame:function(){if(o()(this.chosenGameInfo).length>0){var e=[];(e=this.currentSortData).push(this.chosenGameInfo),this.currentSortData=e,console.log(this.currentSortData),console.log(this.initSortData),this.dialogFormVisible=!1}else this.$message.warning("无游戏可添加")},minusGame:function(e){var t=this.currentSortData;t.splice(e,1),this.currentSortData=t,console.log(this.currentSortData)},saveSort:function(){var e=this,t={};0!==this.currentSortData.length?("ios"===this.currentDeviceType?t={iosGameIdList:this.currentSortData.map(function(e){return e.id})}:"android"===this.currentDeviceType&&(t={androidGameIdList:this.currentSortData.map(function(e){return e.id})}),this.$http.post(this.$baseUrl+this.rankGameByTypeRequest+"/"+this.currentGameTypeId,t).then(function(t){console.log(t),e.getSortList()}).catch(function(t){e.$message.error(t.response.status.toString()+"  "+t.response.data.error)})):this.$message.warning("排序列表不能为空")},focusSortList:function(e,t){var a=this;console.log(this.gameOptions),this.loading=!0,this.queryModel=s()(this.queryModel,{limit:999,page:1,status:1,title:"",description:"",gameTypeId:""}),console.log(this.queryModel),this.$http.get(this.$baseUrl+this.game_infoListRequest,{params:this.queryModel}).then(function(e){console.log(e),a.loading=!1,a.total=e.total;var i=[];0!==e.list.length&&(e.list.forEach(function(e,t){i.push(s()(e,{value:e.name}))}),a.currentSortData.forEach(function(e){i=i.filter(function(t){return e.name!==t.name})}),console.log(111,i),t(i),console.log(222,a.gameOptions))})},chooseGame:function(e){console.log(333,e),this.chosenGameInfo=e,this.queryModel.name=e.value},compareIsSortDataChanged:function(){var e=this,t=!1;return this.initSortData.length!==this.currentSortData.length?t=!0:this.initSortData.forEach(function(a,i){e.currentSortData[i].id!==a.id&&(t=!0)}),t}}},p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("CommonLoading",{attrs:{loading:e.loading,relative:!1}}),e._v(" "),a("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.chooseDeviceType}},e._l(e.$store.state.app.deviceTypeDictionary,function(t){return a("el-tab-pane",{key:t.code,style:{height:e.layoutHeight-5+"px"},attrs:{label:t.name}},[a("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.chooseGameType}},e._l(e.gameTypeInfo.list,function(t,i){return a("el-tab-pane",{key:t.id,attrs:{label:t.name+"(槽位容量"+t.topNumber+")"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[a("div",{staticClass:"common_sortlist_wrapper game_sortlist_container"},[a("ul",{staticClass:"sortlist"},[a("Draggable",{attrs:{options:{}},on:{start:function(t){e.drag=!0},end:function(t){e.drag=!1}},model:{value:e.currentSortData,callback:function(t){e.currentSortData=t},expression:"currentSortData"}},e._l(e.currentSortData,function(t,i){return a("li",{key:t.id},[a("label",{staticClass:"gamename"},[e._v(e._s(t.name))]),e._v(" "),a("a",{staticClass:"minus",on:{click:function(t){e.minusGame(i)}}},[a("span",{staticClass:"add el-icon-remove-outline"})])])}))],1),e._v(" "),e.currentSortData.length<e.currentTopNumber?a("ul",{staticClass:"add"},[a("li",[a("a",{staticClass:"plus",on:{click:e.handleAddGame}},[a("span",{staticClass:"add el-icon-circle-plus-outline"})])])]):e._e()])])],1),e._v(" "),a("el-row",{staticClass:"footer",attrs:{type:"flex",justify:"center"}},[a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[a("el-button",{attrs:{type:"primary",disabled:!e.compareIsSortDataChanged()},on:{click:e.saveSort}},[e._v("保存排序")])],1)],1)],1)}))],1)})),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,width:"600px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form",{ref:"queryModel",attrs:{rules:e.rules,model:e.queryModel,"label-position":"right","label-width":"150px"}},[a("el-form-item",{attrs:{label:"游戏名称",prop:"name"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.focusSortList,placeholder:"请输入内容"},on:{select:e.chooseGame},model:{value:e.chosenGameName,callback:function(t){e.chosenGameName=t},expression:"chosenGameName"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary"},on:{click:e.addGame}},[e._v(e._s(e.$t("table.confirm")))])],1)],1)],1)};p._withStripped=!0;var d={render:p,staticRenderFns:[]},g=d;var h=!1;var y=a("vSla")(m,g,!1,function(e){h||a("fPY9")},null,null);y.options.__file="src\\views\\game\\gameSort.vue";t.default=y.exports},fPY9:function(e,t,a){var i=a("mebv");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("2262a013",i,!1)},mebv:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.game_sortlist_container .gamename {\n  display: inline-block;\n  width: 80%;\n  height: 60px;\n  line-height: 60px;\n  vertical-align: middle;\n  font-size: 20px;\n}\n.game_sortlist_container .sortlist .minus {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n",""])}});
//# sourceMappingURL=9.decc93963879d76e1db7.js.map