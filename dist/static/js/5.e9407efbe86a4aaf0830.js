webpackJsonp([5],{"+sQg":function(t,e,a){var n=a("qbJV");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("8bSs")("2d9bf296",n,!1)},"3cXf":function(t,e,a){t.exports={default:a("RJ+u"),__esModule:!0}},HKt9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("3cXf"),o=a.n(n),i=a("ZLEe"),r=a.n(i),s=a("aA9S"),l=a.n(s),c={components:{CommonQuery:a("zQDM").a},data:function(){return{sendMessageRequest:"notification-service/1.0.0/message",formData:{topics:[],content:"",type:"",iosEnable:"",androidEnable:""},contentFormData:{title:"",subtitle:"",image_thumbnail:"",link:"",desc:"",image:"",url:""},topicsDictionary:[{name:"全体",code:"@sys"}],messageTypeDictionary:[{name:"文本",code:"text"},{name:"HTML",code:"html"},{name:"弹窗",code:"popup"}],queryModel:{},listLoading:!1,tableList:[],pagination:{page:1,size:20},total:0,dialogStatus:"",textMap:{update:"Edit",create:"Create"},rules:{topics:[{required:!0,message:"此项为必填项",trigger:"change"}],content:[{required:!0,message:"此项为必填项",trigger:"change"}],type:[{required:!0,message:"此项为必填项",trigger:"change"}],iosEnable:[{required:!0,message:"此项为必填项",trigger:"change"}],androidEnable:[{required:!0,message:"此项为必填项",trigger:"change"}]},rules2:{title:[{required:!0,message:"此项为必填项",trigger:"change"}],subtitle:[{required:!0,message:"此项为必填项",trigger:"change"}],image_thumbnail:[{required:!0,message:"此项为必填项",trigger:"change"}],link:[{required:!0,message:"此项为必填项",trigger:"change"}],desc:[{required:!0,message:"此项为必填项",trigger:"change"}],image:[{required:!0,message:"此项为必填项",trigger:"change"}],url:[{required:!0,message:"此项为必填项",trigger:"change"}]},dialogFormVisible:!1,editContentFlag:!1,contentFormDictionary:{html:{title:!0,subtitle:!0,image_thumbnail:!0,link:!0,desc:!1,image:!1,url:!1},popup:{title:!0,subtitle:!1,image_thumbnail:!1,link:!1,desc:!0,image:!0,url:!0},text:{title:!1,subtitle:!1,image_thumbnail:!1,link:!1,desc:!1,image:!1,url:!1}},currentContentType:"",currentTopicsType:"",topicsList:["18260045855","17521558498"]}},computed:{tableHeight:function(){return this.$store.state.app.tableHeight-5},currentContentTitle:function(){var t=this;return""!==this.currentContentType?this.messageTypeDictionary.find(function(e){return e.code===t.currentContentType}).name:""}},watch:{effectiveDuration:function(t){console.log(t),null===t&&(t=[]),this.formData.startDate=this.$moment(t[0]).format("YYYY-MM-DD"),this.formData.endDate=this.$moment(t[1]).format("YYYY-MM-DD")},currentAdvertisementTabIndex:function(t){console.log(t)},currentSortData:function(t){var e=this;console.log(t),t.forEach(function(t,a){e.tableList.forEach(function(n,o){t.id===n.id&&(e.tableList[o].orderNum=a)})}),console.log(this.tableList)}},mounted:function(){},methods:{handleFilter:function(){this.pagination.page=1,this.getTableData()},handleSizeChange:function(t){this.pagination.size=t,this.getTableData()},handleCurrentChange:function(t){this.pagination.page=t,this.getTableData()},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,void 0!==this.$refs.formData&&this.$nextTick(function(){t.$refs.formData.clearValidate()})},handleUpdate:function(t){var e=this;console.log("handleUpdate",t),this.formData=l()({},t.row),this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.formData.clearValidate()})},handleDelete:function(t){var e=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http.get(e.$baseUrl+e.deleteActivityRewardMappingByIdRequest+"/"+t.row.id).then(function(t){console.log(t),e.dialogFormVisible=!1,e.$message.success("删除成功"),e.getTableData()}).catch(function(t){console.log(t),e.$message.error(t.response.status.toString()+"  "+t.response.data.error)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},expand:function(){this.expandQuery=!this.expandQuery},search:function(){this.getTableData()},deleteAdvertise:function(t,e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){})},uploadSuccess1:function(t){this.contentFormData.image_thumbnail=t.url},uploadSuccess2:function(t){console.log(t),this.contentFormData.image=t.url},changeDailyLimitMode:function(t){this.formData.number="unlimited"===t.toString()?"-1":this.formData.number},chooseThirdPartyProduct:function(t){this.chosenThirdPartyProductInfo=t,this.formData.rewardId=t.id},focusSortList:function(t,e){var a=this;this.loading=!0,this.$http.get(this.$baseUrl+this.queryRewardProductByNameRequest,{params:{name:this.chosenReward}}).then(function(t){console.log(t),a.loading=!1;var n=[];0!==t.data.length&&(t.data.forEach(function(t,e){n.push(l()(t,{value:t.name}))}),console.log(111,n),e(n))})},chooseContentType:function(){this.currentContentType=this.formData.type,this.resetContentData(),this.formData.content=""},changeTopics:function(t){var e=this;console.log(t);var a=[];t.forEach(function(t){a.push(-1===t.indexOf("@me_")?e.currentTopicsType+t:t)}),this.formData.topics=a,console.log(this.formData.topics)},chooseTopicsType:function(t){console.log(t),"@sys"===this.currentTopicsType&&(this.formData.topics=["@sys"])},editContent:function(){this.editContentFlag=!0},resetContentData:function(){var t=this;r()(this.contentFormData).forEach(function(e){t.contentFormData[e]=""}),console.log(this.$refs.contentFormData)},resetTemp:function(){this.formData=l()(this.formData,{topics:"",content:"",type:"",iosEnable:"",androidEnable:""})},encodeData:function(){var t=this;this.$refs.contentFormData.validate(function(e){if(e){var a={},n=t.contentFormDictionary[t.currentContentType];r()(n).forEach(function(e){n[e]&&(a[e]=t.contentFormData[e])}),a=o()(a),console.log(a),t.formData.content=a,t.editContentFlag=!1}})},sendMessage:function(){var t=this;this.$refs.formData.validate(function(e){e&&t.$http.post(t.$baseUrl+t.sendMessageRequest,[t.formData]).then(function(e){console.log(e),t.$message.success("发送成功")}).catch(function(e){t.$message.error(e.response.status.toString()+"  "+e.response.data.error)})})}}},u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"app-container"},[a("CommonQuery",{attrs:{expand:!1}},[a("template",{slot:"button1"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v("\n        发送消息\n      ")])],1)],2),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:t.tableList,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":"",height:t.tableHeight}},[a("el-table-column",{attrs:{label:"No",type:"index",width:"50",align:"center",fixed:""}}),t._v(" "),a("el-table-column",{attrs:{label:"是否可用",align:"center",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949",disabled:""},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"300px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.handleUpdate(e)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.handleDelete(e)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("div",{staticClass:"common-pagination-wrapper"},[a("el-pagination",{attrs:{background:"","current-page":t.pagination.page,"page-sizes":[10,20,30,50],"page-size":t.pagination.size,total:t.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.pagination,"page",e)}}})],1),t._v(" "),a("el-dialog",{attrs:{title:"发送消息",visible:t.dialogFormVisible,width:"850px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form",{ref:"formData",attrs:{rules:t.rules,model:t.formData,"label-position":"right","label-width":"140px"}},[a("el-form-item",{attrs:{label:"topics",prop:"topics"}},[t._l(t.topicsDictionary,function(e){return a("el-radio",{key:e.code,attrs:{label:e.code},on:{change:t.chooseTopicsType},model:{value:t.currentTopicsType,callback:function(e){t.currentTopicsType=e},expression:"currentTopicsType"}},[t._v(t._s(e.name)+"\n            ")])}),t._v(" "),"@me_"===t.currentTopicsType?a("el-select",{attrs:{multiple:""},on:{change:t.changeTopics},model:{value:t.formData.topics,callback:function(e){t.$set(t.formData,"topics",e)},expression:"formData.topics"}},t._l(t.topicsList,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})):t._e()],2),t._v(" "),a("el-form-item",{attrs:{label:"消息类型",prop:"type"}},[a("el-select",{on:{change:t.chooseContentType},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},t._l(t.messageTypeDictionary,function(t){return a("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"内容",prop:"content"}},["text"===t.currentContentType?a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}}):a("el-button",{attrs:{type:"primary",disabled:""===t.currentContentType},on:{click:t.editContent}},[t._v("编辑")])],1),t._v(" "),"text"!==t.currentContentType?a("div",{staticClass:"sendmessage_contentformdata_wrapper"},[a("el-table",{attrs:{data:[t.contentFormData]}},t._l(t.contentFormData,function(e,n){return a("el-table-column",{key:n,attrs:{label:n},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{style:{"min-height":"50px"}},[t._v("\n                    "+t._s(t.contentFormData[n])+"\n                  ")])]}}])})}))],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"iOS可用性",prop:"iosEnable"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.formData.iosEnable,callback:function(e){t.$set(t.formData,"iosEnable",e)},expression:"formData.iosEnable"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Android可用性",prop:"androidEnable"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.formData.androidEnable,callback:function(e){t.$set(t.formData,"androidEnable",e)},expression:"formData.androidEnable"}})],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("关闭")]),t._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary"},on:{click:t.sendMessage}},[t._v("发送消息")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑"+t.currentContentTitle+"内容",visible:t.editContentFlag,width:"850px","close-on-click-modal":!1},on:{"update:visible":function(e){t.editContentFlag=e}}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[""!==t.currentContentType?a("el-form",{ref:"contentFormData",attrs:{rules:t.rules2,model:t.contentFormData,"label-position":"right","label-width":"140px"}},[t.contentFormDictionary[t.currentContentType].title?a("el-form-item",{attrs:{label:"title",prop:"title"}},[a("el-input",{model:{value:t.contentFormData.title,callback:function(e){t.$set(t.contentFormData,"title",e)},expression:"contentFormData.title"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].subtitle?a("el-form-item",{attrs:{label:"subtitle",prop:"subtitle"}},[a("el-input",{model:{value:t.contentFormData.subtitle,callback:function(e){t.$set(t.contentFormData,"subtitle",e)},expression:"contentFormData.subtitle"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].topics?a("el-form-item",{attrs:{label:"topics",prop:"topics"}},[a("el-select",{model:{value:t.contentFormData.topics,callback:function(e){t.$set(t.contentFormData,"topics",e)},expression:"contentFormData.topics"}},t._l(t.topicsDictionary,function(t){return a("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})})),t._v(" "),a("el-input",{model:{value:t.contentFormData.subtitle,callback:function(e){t.$set(t.contentFormData,"subtitle",e)},expression:"contentFormData.subtitle"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].image_thumbnail?a("el-form-item",{attrs:{label:"image_thumbnail",prop:"image_thumbnail"}},[a("CommonUploadImage",{attrs:{action:t.$baseUrl+"image-upload-service/1.0.0/file/upload",returnUrlList:t.contentFormData.image_thumbnail,fileType:"image"},on:{"on-success":t.uploadSuccess1,"update:returnUrlList":function(e){t.$set(t.contentFormData,"image_thumbnail",e)}}}),t._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:t.contentFormData.image_thumbnail,callback:function(e){t.$set(t.contentFormData,"image_thumbnail",e)},expression:"contentFormData.image_thumbnail"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].link?a("el-form-item",{attrs:{label:"link",prop:"link"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.contentFormData.link,callback:function(e){t.$set(t.contentFormData,"link",e)},expression:"contentFormData.link"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].desc?a("el-form-item",{attrs:{label:"desc",prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.contentFormData.desc,callback:function(e){t.$set(t.contentFormData,"desc",e)},expression:"contentFormData.desc"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].image?a("el-form-item",{attrs:{label:"image",prop:"image"}},[a("CommonUploadImage",{attrs:{action:t.$baseUrl+"image-upload-service/1.0.0/file/upload",returnUrlList:t.contentFormData.image,fileType:"image"},on:{"on-success":t.uploadSuccess2,"update:returnUrlList":function(e){t.$set(t.contentFormData,"image",e)}}}),t._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:t.contentFormData.image,callback:function(e){t.$set(t.contentFormData,"image",e)},expression:"contentFormData.image"}})],1):t._e(),t._v(" "),t.contentFormDictionary[t.currentContentType].url?a("el-form-item",{attrs:{label:"url",prop:"url"}},[a("el-input",{model:{value:t.contentFormData.url,callback:function(e){t.$set(t.contentFormData,"url",e)},expression:"contentFormData.url"}})],1):t._e()],1):t._e()],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],on:{click:function(e){t.editContentFlag=!1}}},[t._v(t._s(t.$t("table.cancel")))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.encodeData}},[t._v(t._s(t.$t("table.confirm")))])],1)],1)],1)};u._withStripped=!0;var m={render:u,staticRenderFns:[]},p=m;var d=!1;var f=a("vSla")(c,p,!1,function(t){d||a("+sQg")},null,null);f.options.__file="src\\views\\message\\SendMessage.vue";e.default=f.exports},"RJ+u":function(t,e,a){var n=a("AKd3"),o=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return o.stringify.apply(o,arguments)}},qbJV:function(t,e,a){(t.exports=a("BkJT")(!1)).push([t.i,"\n.sendmessage_contentformdata_wrapper {\n  /*height: 500px;*/\n}\n",""])}});
//# sourceMappingURL=5.e9407efbe86a4aaf0830.js.map